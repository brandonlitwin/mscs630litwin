{% extends "base.html" %}

{% block app_content %}
    <h1>{{ 'Messages' }}</h1>
    {% for message in messages %}
    <table class="table table-hover">
      <tr>
          <td width="70px">
              <a href="{{ url_for('main.user', username=message.sender.username) }}">
                  <img src="{{ message.sender.avatar(70) }}" />
              </a>
          </td>
          <td>
              {% set user_link %}
                  <span class="user_popup">
                      <a href="{{ url_for('main.user', username=message.sender.username) }}">
                          {{ message.sender.username }}
                      </a>
                  </span>
              {% endset %}
              From: {{message.sender.username}} at {{message.timestamp}}
              <br><br>
              <span id="message{{ message.id }}encrypted">Ciphertext: {{ message.encrypted }}</span>

              {% if message.recipient_id == current_user.id %}
              <br><br><span id="message{{ message.id }}key">Key: {{ message.key }}</span>
              <br><br><span id="message{{ message.id }}decrypted" style="display: none;">Decrypted: {{ message.body }}</span><br><br>
              {% endif %}
              <button id="message{{ message.id }}decryptbutton" onclick='showDecryption("message{{ message.id }}decrypted")'>Decrypt</button>
          </td>
      </tr>
  </table>
  <script>
    function showDecryption(decryptMessageID) {
        var x = document.getElementById(decryptMessageID);
        if (x.style.display === "none") {
          x.style.display = "block";
        } else {
          x.style.display = "none";
        }
    }
</script>
    {% endfor %}
    <nav aria-label="...">
        <ul class="pager">
            <li class="previous{% if not prev_url %} disabled{% endif %}">
                <a href="{{ prev_url or '#' }}">
                    <span aria-hidden="true">&larr;</span> {{ 'Newer messages' }}
                </a>
            </li>
            <li class="next{% if not next_url %} disabled{% endif %}">
                <a href="{{ next_url or '#' }}">
                    {{ 'Older messages' }} <span aria-hidden="true">&rarr;</span>
                </a>
            </li>
        </ul>
    </nav>
{% endblock %}